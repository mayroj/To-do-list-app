!function(e){"use strict";function t(e,t){var i=this;i.model=e,i.view=t,i.view.bind("newTodo",function(e){i.addItem(e)}),i.view.bind("itemEdit",function(e){i.editItem(e.id)}),i.view.bind("itemEditDone",function(e){i.editItemSave(e.id,e.title)}),i.view.bind("itemEditCancel",function(e){i.editItemCancel(e.id)}),i.view.bind("itemRemove",function(e){i.removeItem(e.id)}),i.view.bind("itemToggle",function(e){i.toggleComplete(e.id,e.completed)}),i.view.bind("removeCompleted",function(){i.removeCompletedItems()}),i.view.bind("toggleAll",function(e){i.toggleAll(e.completed)})}t.prototype.setView=function(e){var t=e.split("/")[1]||"";this._updateFilterState(t)},t.prototype.showAll=function(){var t=this;t.model.read(function(e){t.view.render("showEntries",e)})},t.prototype.showActive=function(){var t=this;t.model.read({completed:!1},function(e){t.view.render("showEntries",e)})},t.prototype.showCompleted=function(){var t=this;t.model.read({completed:!0},function(e){t.view.render("showEntries",e)})},t.prototype.addItem=function(e){var t=this;""!==e.trim()&&t.model.create(e,function(){t.view.render("clearNewTodo"),t._filter(!0)})},t.prototype.editItem=function(t){var i=this;i.model.read(t,function(e){i.view.render("editItem",{id:t,title:e[0].title})})},t.prototype.editItemSave=function(e,t){for(var i=this;" "===t[0];)t=t.slice(1);for(;" "===t[t.length-1];)t=t.slice(0,-1);0!==t.length?i.model.update(e,{title:t},function(){i.view.render("editItemDone",{id:e,title:t})}):i.removeItem(e)},t.prototype.editItemCancel=function(t){var i=this;i.model.read(t,function(e){i.view.render("editItemDone",{id:t,title:e[0].title})})},t.prototype.removeItem=function(t){var i,e=this;e.model.read(function(e){i=e}),i.forEach(function(e){e.id===t&&console.log("Element with ID: "+t+" has been removed.")}),e.model.remove(t,function(){e.view.render("removeItem",t)}),e._filter()},t.prototype.removeCompletedItems=function(){var t=this;t.model.read({completed:!0},function(e){e.forEach(function(e){t.removeItem(e.id)})}),t._filter()},t.prototype.toggleComplete=function(e,t,i){var o=this;o.model.update(e,{completed:t},function(){o.view.render("elementComplete",{id:e,completed:t})}),i||o._filter()},t.prototype.toggleAll=function(t){var i=this;i.model.read({completed:!t},function(e){e.forEach(function(e){i.toggleComplete(e.id,t,!0)})}),i._filter()},t.prototype._updateCount=function(){var t=this;t.model.getCount(function(e){t.view.render("updateElementCount",e.active),t.view.render("clearCompletedButton",{completed:e.completed,visible:0<e.completed}),t.view.render("toggleAll",{checked:e.completed===e.total}),t.view.render("contentBlockVisibility",{visible:0<e.total})})},t.prototype._filter=function(e){var t=this._activeRoute.charAt(0).toUpperCase()+this._activeRoute.substr(1);this._updateCount(),(e||"All"!==this._lastActiveRoute||this._lastActiveRoute!==t)&&this["show"+t](),this._lastActiveRoute=t},t.prototype._updateFilterState=function(e){""===(this._activeRoute=e)&&(this._activeRoute="All"),this._filter(),this.view.render("setFilter",e)},e.app=e.app||{},e.app.Controller=t}(window);